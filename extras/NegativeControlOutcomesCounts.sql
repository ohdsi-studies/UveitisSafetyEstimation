--ccae
with cte as (
  select
    c.concept_id,
    c.concept_name,
    ca.descendant_concept_id
  from cdm_truven_ccae_v2044.concept c
  join cdm_truven_ccae_v2044.concept_ancestor ca
    on ca.ancestor_concept_id = c.concept_id
  where c.concept_id in (201826,321689,313459,4209423,442588,138384,437833,133729,373769,201254,374375,437246,4308509,433163,434610,201916,4156515,438134,4102183,443800,200528,73754,4142875,193326,40304526,4302555,377575,381877,433527,199075,440129,4098604,381290,377888,440276,197607,434004,253796,436940,73560,434002,441829,195873,434164,257683,4152350,40326053,443524,4196636,197675,4146209,437969,374367,195590,79833,195862,317376,379832,195012,434821,439081,136934,134765,377294,4143972,4209859,438730,74052,439794,4225324,4299544,441561,4305841,140362,136516,374053,441553,4241033,4181744,198802,197239,75311,316814,436093,372897,381033,195212,194475,194408,4192647,4152370,261116,432508,198715,434374,437241,133327,435787,438114,434910)
)
select
	cte.concept_id,
	cte.concept_name,
	count(*) records
from cdm_truven_ccae_v2044.condition_occurrence co
join scratch_jweave17.epi_964_5 c
  on co.person_id = c.subject_id
JOIN cte
  ON cte.descendant_concept_id = co.condition_concept_id
where co.condition_start_date > c.cohort_start_date
and co.condition_start_date <= c.cohort_end_date
and c.cohort_definition_id in (93678449, 93688449, 93699028, 93709028, 93719029, 93729029, 93739048, 93749048)
group by 
	cte.concept_id,
	cte.concept_name
order by count(*) desc
;


--optumdod
with cte as (
  select
    c.concept_id,
    c.concept_name,
    ca.descendant_concept_id
  from cdm_optum_extended_dod_v2050.concept c
  join cdm_optum_extended_dod_v2050.concept_ancestor ca
    on ca.ancestor_concept_id = c.concept_id
  where c.concept_id in (201826,321689,313459,4209423,442588,138384,437833,133729,373769,201254,374375,437246,4308509,433163,434610,201916,4156515,438134,4102183,443800,200528,73754,4142875,193326,40304526,4302555,377575,381877,433527,199075,440129,4098604,381290,377888,440276,197607,434004,253796,436940,73560,434002,441829,195873,434164,257683,4152350,40326053,443524,4196636,197675,4146209,437969,374367,195590,79833,195862,317376,379832,195012,434821,439081,136934,134765,377294,4143972,4209859,438730,74052,439794,4225324,4299544,441561,4305841,140362,136516,374053,441553,4241033,4181744,198802,197239,75311,316814,436093,372897,381033,195212,194475,194408,4192647,4152370,261116,432508,198715,434374,437241,133327,435787,438114,434910)
)
select
	cte.concept_id,
	cte.concept_name,
	count(*) records
from cdm_optum_extended_dod_v2050.condition_occurrence co
join scratch_jweave17.epi_964_5 c
  on co.person_id = c.subject_id
JOIN cte
  ON cte.descendant_concept_id = co.condition_concept_id
where co.condition_start_date > c.cohort_start_date
and co.condition_start_date <= c.cohort_end_date
and c.cohort_definition_id in (93678449, 93688449, 93699028, 93709028, 93719029, 93729029, 93739048, 93749048)
group by 
	cte.concept_id,
	cte.concept_name
order by count(*) desc
;


--optumehr
with cte as (
  select
    c.concept_id,
    c.concept_name,
    ca.descendant_concept_id
  from cdm_optum_ehr_v1990.concept c
  join cdm_optum_ehr_v1990.concept_ancestor ca
    on ca.ancestor_concept_id = c.concept_id
  where c.concept_id in (201826,321689,313459,4209423,442588,138384,437833,133729,373769,201254,374375,437246,4308509,433163,434610,201916,4156515,438134,4102183,443800,200528,73754,4142875,193326,40304526,4302555,377575,381877,433527,199075,440129,4098604,381290,377888,440276,197607,434004,253796,436940,73560,434002,441829,195873,434164,257683,4152350,40326053,443524,4196636,197675,4146209,437969,374367,195590,79833,195862,317376,379832,195012,434821,439081,136934,134765,377294,4143972,4209859,438730,74052,439794,4225324,4299544,441561,4305841,140362,136516,374053,441553,4241033,4181744,198802,197239,75311,316814,436093,372897,381033,195212,194475,194408,4192647,4152370,261116,432508,198715,434374,437241,133327,435787,438114,434910)
)
select
	cte.concept_id,
	cte.concept_name,
	count(*) records
from cdm_optum_ehr_v1990.condition_occurrence co
join scratch_jweave17.epi_964_5 c
  on co.person_id = c.subject_id
JOIN cte
  ON cte.descendant_concept_id = co.condition_concept_id
where co.condition_start_date > c.cohort_start_date
and co.condition_start_date <= c.cohort_end_date
and c.cohort_definition_id in (93678449, 93688449, 93699028, 93709028, 93719029, 93729029, 93739048, 93749048)
group by 
	cte.concept_id,
	cte.concept_name
order by count(*) desc
;









